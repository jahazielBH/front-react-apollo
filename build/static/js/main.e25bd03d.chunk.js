(this["webpackJsonphackernews-react-apollo"]=this["webpackJsonphackernews-react-apollo"]||[]).push([[0],{60:function(e,n,t){},69:function(e,n,t){"use strict";t.r(n);var a,c,r=t(8),s=t(1),i=t(46),o=t.n(i),l=(t(60),t(20)),d=t(16),u=t(80),j=t(84),b=t(4),m=t(3),p=Object(u.a)(a||(a=Object(d.a)(["\n  mutation CreateLink(\n    $description: String!\n    $url: String!\n  ) {\n    createLink(description: $description, url: $url) {\n      id\n      url\n      description\n    }\n  }\n"]))),h=function(){var e=Object(b.f)(),n=Object(s.useState)({description:"",url:""}),t=Object(l.a)(n,2),a=t[0],c=t[1],i=Object(j.a)(p,{variables:{description:a.description,url:a.url},onCompleted:function(){return e.push("/")}}),o=Object(l.a)(i,1)[0];return Object(m.jsx)("div",{children:Object(m.jsxs)("form",{onSubmit:function(e){e.preventDefault(),o()},children:[Object(m.jsxs)("div",{className:"flex flex-column mt3",children:[Object(m.jsx)("input",{className:"mb2",value:a.description,onChange:function(e){return c(Object(r.a)(Object(r.a)({},a),{},{description:e.target.value}))},type:"text",placeholder:"A description for the link"}),Object(m.jsx)("input",{className:"mb2",value:a.url,onChange:function(e){return c(Object(r.a)(Object(r.a)({},a),{},{url:e.target.value}))},type:"text",placeholder:"The URL for the link"})]}),Object(m.jsx)("button",{type:"submit",children:"Submit"})]})})},O=t(19),v="auth-token",x=function(){var e=Object(b.f)(),n=localStorage.getItem(v);return Object(m.jsxs)("div",{className:"flex pa1 justify-between nowrap orange",children:[Object(m.jsxs)("div",{className:"flex flex-fixed black",children:[Object(m.jsx)("div",{className:"fw7 mr1",children:"Hacker News"}),Object(m.jsx)(O.b,{to:"/",className:"ml1 no-underline black",children:"new"}),Object(m.jsx)("div",{className:"ml1",children:"|"}),Object(m.jsx)(O.b,{to:"/top",className:"ml1 no-underline black",children:"top"}),Object(m.jsx)("div",{className:"ml1",children:"|"}),Object(m.jsx)(O.b,{to:"/search",className:"ml1 no-underline black",children:"search"}),n&&Object(m.jsxs)("div",{className:"flex",children:[Object(m.jsx)("div",{className:"ml1",children:"|"}),Object(m.jsx)(O.b,{to:"/create",className:"ml1 no-underline black",children:"submit"})]})]}),Object(m.jsx)("div",{className:"flex flex-fixed",children:n?Object(m.jsx)("div",{className:"ml1 pointer black",onClick:function(){localStorage.removeItem(v),e.push("/")},children:"logout"}):Object(m.jsx)(O.b,{to:"/login",className:"ml1 no-underline black",children:"login"})})]})},f=t(36),g=t(83);function k(e){return function(e,n){var t=6e4,a=36e5,c=864e5,r=2592e6,s=31536e6,i=e-n;return i<2e4?"just now":i<t?"less than 1 min ago":i<a?Math.round(i/t)+" min ago":i<c?Math.round(i/a)+" h ago":i<r?Math.round(i/c)+" days ago":i<s?Math.round(i/r)+" mo ago":Math.round(i/s)+" years ago"}((new Date).getTime(),new Date(e).getTime())}var w,y,N,$,C,S=Object(u.a)(c||(c=Object(d.a)(["\n  mutation CreateVote($linkId: ID!) {\n    createVote(linkId: $linkId) {\n      link{\n        id\n        votes {\n            edges {\n              node {\n                id\n              }\n            }\n          }\n      }\n      user{\n        id\n      }\n    }\n  }\n"]))),B=function(e){var n=e.link,t=localStorage.getItem(v),a={createdAt:"desc"},c=Object(j.a)(S,{variables:{linkId:n.id},update:function(e,t){var c=t.data.vote,s=e.readQuery({query:I,variables:{take:5,skip:0,orderBy:a}}).feed.links.map((function(e){return e.id===n.id?Object(r.a)(Object(r.a)({},e),{},{votes:[].concat(Object(f.a)(e.votes),[c])}):e}));e.writeQuery({query:I,data:{feed:{links:s}},variables:{take:5,skip:0,orderBy:a}})}}),s=Object(l.a)(c,1)[0];return Object(m.jsxs)("div",{className:"flex mt2 items-start",children:[Object(m.jsxs)("div",{className:"flex items-center",children:[Object(m.jsxs)("span",{className:"gray",children:[e.index+1,"."]}),t&&Object(m.jsx)("div",{className:"ml1 gray f11",style:{cursor:"pointer"},onClick:s,children:"\u25b2"})]}),Object(m.jsxs)("div",{className:"ml1",children:[Object(m.jsxs)("div",{children:[n.description," (",n.url,")"]}),t&&Object(m.jsxs)("div",{className:"f6 lh-copy gray",children:[n.votes.length," votes | by"," ",n.postedBy?n.postedBy.username:"Unknown"," ",k(n.createdAt)]})]})]})},I=Object(u.a)(w||(w=Object(d.a)(["\n  query FeedQuery(\n    $take: Int\n    $skip: Int\n    $orderBy: LinkOrderByInput\n  ) {\n    feed(take: $take, skip: $skip, orderBy: $orderBy) {\n      id\n      links {\n        id\n        url\n        description\n        postedBy {\n          id\n          name\n        }\n        votes {\n          id\n          user {\n            id\n          }\n        }\n        createdAt\n      }\n      count\n    }\n  }\n"]))),A=Object(u.a)(y||(y=Object(d.a)(["\n  subscription {\n    newLink {\n      id\n      url\n      description\n      postedBy {\n        id\n        name\n      }\n      votes {\n        id\n        user {\n          id\n        }\n      }\n      createdAt\n    }\n  }\n"]))),L=Object(u.a)(N||(N=Object(d.a)(["\n  subscription {\n    newVote {\n      id\n      link {\n        id\n        url\n        description\n        postedBy {\n          id\n          name\n        }\n        votes {\n          id\n          user {\n            id\n          }\n        }\n        createdAt\n      }\n      user {\n        id\n      }\n    }\n  }\n"]))),M=function(e,n){if(e)return n.feed.links;var t=n.feed.links.slice();return t.sort((function(e,n){return n.votes.length-e.votes.length})),t},D=function(e,n){return{take:e?5:100,skip:e?5*(n-1):0,orderBy:{createdAt:"desc"}}},T=function(){var e=Object(b.f)(),n=e.location.pathname.includes("new"),t=e.location.pathname.split("/"),a=parseInt(t[t.length-1]),c=a?5*(a-1):0,r=Object(g.a)(I,{variables:D(n,a)}),s=r.data,i=r.loading,o=r.error,l=r.subscribeToMore;return l({document:A,updateQuery:function(e,n){var t=n.subscriptionData;if(!t.data)return e;var a=t.data.newLink;return e.feed.links.find((function(e){return e.id===a.id}))?e:Object.assign({},e,{feed:{links:[a].concat(Object(f.a)(e.feed.links)),count:e.feed.links.length+1,__typename:e.feed.__typename}})}}),l({document:L}),Object(m.jsxs)(m.Fragment,{children:[i&&Object(m.jsx)("p",{children:"Loading..."}),o&&Object(m.jsx)("pre",{children:JSON.stringify(o,null,2)}),s&&Object(m.jsxs)(m.Fragment,{children:[M(n,s).map((function(e,n){return Object(m.jsx)(B,{link:e,index:n+c},e.id)})),n&&Object(m.jsxs)("div",{className:"flex ml4 mv3 gray",children:[Object(m.jsx)("div",{className:"pointer mr2",onClick:function(){a>1&&e.push("/new/".concat(a-1))},children:"Previous"}),Object(m.jsx)("div",{className:"pointer",onClick:function(){if(a<=s.feed.count/5){var n=a+1;e.push("/new/".concat(n))}},children:"Next"})]})]})]})},U=Object(u.a)($||($=Object(d.a)(["\n  mutation CreateUser($email: String!, $password: String!, $username: String!) {\n    createUser(\n      email: $email,\n      password: $password,\n      username: $username\n    ){\n      user{\n        email\n        username\n      }\n    }\n  }\n"]))),q=Object(u.a)(C||(C=Object(d.a)(["\n  mutation TokenAuth(\n    $username: String!,\n    $password: String!\n  ) {\n    tokenAuth(username: $username, password: $password) {\n      token\n    }\n  }\n"]))),Q=function(){var e=Object(b.f)(),n=Object(s.useState)({login:!0,email:"",password:"",username:""}),t=Object(l.a)(n,2),a=t[0],c=t[1],i=Object(j.a)(q,{variables:{username:a.username,password:a.password},onCompleted:function(n){var t=n.tokenAuth;console.log(t),localStorage.setItem(v,t.token),e.push("/")}}),o=Object(l.a)(i,1)[0],d=Object(j.a)(U,{variables:{username:a.username,email:a.email,password:a.password},onCompleted:function(n){n.signup;e.push("/")}}),u=Object(l.a)(d,1)[0];return Object(m.jsxs)("div",{children:[Object(m.jsx)("h4",{className:"mv3",children:a.login?"Login":"Sign Up"}),Object(m.jsxs)("div",{className:"flex flex-column",children:[!a.login&&Object(m.jsx)("input",{value:a.email,onChange:function(e){return c(Object(r.a)(Object(r.a)({},a),{},{email:e.target.value}))},type:"text",placeholder:"Your email address"}),Object(m.jsx)("input",{value:a.username,onChange:function(e){return c(Object(r.a)(Object(r.a)({},a),{},{username:e.target.value}))},type:"text",placeholder:"Your username"}),Object(m.jsx)("input",{value:a.password,onChange:function(e){return c(Object(r.a)(Object(r.a)({},a),{},{password:e.target.value}))},type:"password",placeholder:"Choose a safe password"})]}),Object(m.jsxs)("div",{className:"flex mt3",children:[Object(m.jsx)("button",{className:"pointer mr2 button",onClick:a.login?o:u,children:a.login?"login":"create account"}),Object(m.jsx)("button",{className:"pointer button",onClick:function(e){return c(Object(r.a)(Object(r.a)({},a),{},{login:!a.login}))},children:a.login?"need to create an account?":"already have an account?"})]})]})},_=function(){return Object(m.jsxs)("div",{className:"center w85",children:[Object(m.jsx)(x,{}),Object(m.jsx)("div",{className:"ph3 pv1 background-gray",children:Object(m.jsxs)(b.c,{children:[Object(m.jsx)(b.a,{exact:!0,path:"/",component:T}),Object(m.jsx)(b.a,{exact:!0,path:"/create",component:h}),Object(m.jsx)(b.a,{exact:!0,path:"/login",component:Q})]})})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var F=t(51),J=t(52),V=t(81),W=t(82),Y=t(79),z=Object(J.a)({uri:"http://35.232.232.192:8091/graphql/"}),E=Object(F.a)((function(e,n){var t=n.headers,a=localStorage.getItem(v);return{headers:Object(r.a)(Object(r.a)({},t),{},{authorization:a?"Bearer ".concat(a):""})}})),H=new V.a({link:E.concat(z),cache:new W.a});o.a.render(Object(m.jsx)(O.a,{children:Object(m.jsx)(Y.a,{client:H,children:Object(m.jsx)(_,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[69,1,2]]]);
//# sourceMappingURL=main.e25bd03d.chunk.js.map